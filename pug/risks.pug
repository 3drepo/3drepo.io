doctype html
html(lang="en" ng-app="3drepo").ng-scope
	script(type="text/javascript", src="/config.js")
	link(rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,400italic")
	style.
		html, body {
				font-family: Roboto, sans-serif;
		}
		table {
			border-collapse: separate;
			border-spacing: 10px;
		}
		.bold {
			font-weight: bold;
		}
	head
		each risksByStatus, status in risks
			if status === "open" && risksByStatus.length > 0
				h2 Open Risks
			else if status === "closed" && risksByStatus.length > 0
				h2 Closed Risks

			// TODO: Time stamps - What is going on here?!
			each risk in risksByStatus.sort((a, b) => { return new Date(b.created).getTime() - new Date(a.created).getTime()  } )
				hr
				table(border=0)
					tr
						td(colspan=2)
							h3 ##{risk.number} #{risk.name}
					if risk.viewpoint.screenshotSmall
						tr
							td(colspan=2) 
								a(href=url(risk.viewpoint.screenshot) target='_blank')
									img(src=url(risk.viewpoint.screenshotSmall))

					tr
						td(colspan=2)
							b Assigned:
							span [#{risk.assigned_roles.join(", ")}] 

							b Priority: 
							span #{risk.priority} 

							b Status: 
							span #{risk.status} 

							b Type: 
							span #{risk.topic_type}

					tr
						td(colspan=2)
							b Description: 
							span #{risk.desc}
					tr
						td
							span.bold #{risk.owner} 
							span [#{new Date(risk.created).toUTCString()}]
						td Risk Opened....
					if risk.comments
						each comment in risk.comments
							tr
								td
									span.bold #{comment.owner} 
									span [#{new Date(comment.created).toUTCString()}]
								td 
									if comment.comment
										| #{comment.comment}
									if comment.action
										| #{comment.action.propertyText} changed from 
										i #{comment.action.from} 
										| to 
										i #{comment.action.to}
							if comment.viewpoint && comment.viewpoint.screenshotSmall
								tr
									td(colspan=2)
										a(href=url(comment.viewpoint.screenshot) target='_blank')
											img(src=url(comment.viewpoint.screenshotSmall))
								
				br

