extends layout

block content

	script(src="/js/measurer.js")

	//- Recursive Tree View
	script(type="text/ng-template" id="tree_element.html")
		a(href="#" ng-click="select_item(data); navigate_to(data)")
			//- Pick the correct icon
			i(ng-if="!data.nodes" ng-class="iconLeaf" class="icon" ng-click="toggle_expand(data)")
			i(ng-if="data.nodes && !data.expanded" ng-class="iconExpand" class="icon" ng-click="toggle_expand(data)")
			i(ng-if="data.nodes && data.expanded" ng-class="iconCollapse" class="icon" ng-click="toggle_expand(data)")
			span {{data.name}}

			//- If this is not a leaf node and linked, we just display the total of its children
			div(class="itempricegroup" ng-if="data.nodes && data.linked") 
				div(class="linkicon") 
					i(ng-class="iconLink" class="icon"  ng-click="toggle_link(data)")
				div(class="itemprice" style="font-weight: bold;") {{compute_bid(data)}}

			//- Otherwise we allow an input field to set the bid
			form(class="itempricegroup" ng-if="!data.nodes || !data.linked")
				//- For leaf nodes use hidden icon to keep the same margin
				div(class="linkicon-hidden" ng-if="!data.nodes") 
					i(ng-class="iconLink" class="icon")
				//- For non-leaf nodes, disable the link icon by making it semi transparent
				div(class="linkicon-disabled" ng-if="data.nodes" ng-click="toggle_link(data)") 
					i(ng-class="iconLink" class="icon")
				//- Bid input - make sure to defocus on enter, only allow numbers for the moment, bind to the current data.bid						
				div(class="itemprice")
					input(ui-event="{keypress:'blur_on_enter($event)'}" class="priceinput" type="tel" onkeypress='return event.charCode >= 48 && event.charCode <= 57' min="0" ng-model="data.bid" size="20")

		//- Recurse on chilren
		ul(ng-show="data.expanded" class="nav nav-pills nav-stacked treerow")
			li(ng-repeat="data in data.nodes | orderBy:name" class="{{selected === data.name ? 'active' : ''}}" ng-include="'tree_element.html'")

	script(type="text/ng-template" id="treeview.html")
		div.treeview
				div(ng-init="param")
				div.treeview-header
					h3 Total Bid: Â£{{compute_total()}}
				ul(class="nav nav-pills nav-stacked treerow")
					li(ng-repeat="data in tree" class="{{selected === data.name ? 'active' : ''}}" ng-include="'tree_element.html'")

	//- Hack for the demo, render the list of objects
	script.
		var objs = !{objs};

	h1#logo 3D Repo
	nav.navbar.whitenavbar.navbar-fixed-top(role='navigation')
		div.container-fluid
			div.navbar-header
				button.navbar-toggle.collapsed(type="button" data-toggle="collapse" data-target=".navbar-collapse")
					span.glyphicon.glyphicon-th
					span.icon-bar
			div.collapse.navbar-collapse
				ul.nav.navbar-nav
					li.dropdown
						a(href='/home') Home
					li.dropdown
						a.dropdown-toggle(data-toggle="dropdown" href='#') Tools
							span.caret
						ul.dropdown-menu(role='menu')
							li
								a#measure(href='#') Measure
					li.dropdown
						a.dropdown-toggle(data-toggle="dropdown" href='#') View
							span.caret
						ul.dropdown-menu(role='menu')
							li
								a#view-everything(href='#') Everything
							li
								a#view-def-viewpoint(href='#') Default Viewpoint

	div.fill
		ui-view
		div.viewport
			x3d(xmlns="http://www.web3d.org/specification/x3d-namespace" id="model" showStat="true" showLog="false" style="width:100%; height:100%; border:0px;")
				scene
					!{xml}



