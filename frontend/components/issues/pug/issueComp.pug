div.heightFix(flex, layout="column", layout-fill, tabindex="0", tdr-focus="true")
	div
		// Title
		.issueCompItemContainer#issueCompTitleArea(
		layout="column"
		layout-align="start"
		flex
		ng-class="{issueCompTitleArea: vm.data}"
		ng-click="vm.toggleShowAdditional()")
			div(layout="row", flex, layout-align="space-between")
				div(layout="row", flex)
					#issueRoleIndicator
					md-input-container#issueCompTitleInput(ng-if="!vm.data", flex, md-no-float)
						input(
						type="text"
						ng-model="vm.issueData.name"
						ng-change="vm.nameChange()"
						ng-disabled="vm.data"
						ng-focus="vm.textInputHasFocus(true)"
						ng-blur="vm.textInputHasFocus(false)"
						aria-label="Title"
						tdr-focus="true"
						required
						placeholder="Title",
						ng-click="vm.titleInputClick($event)")
					label#issueCompTitle(ng-if="vm.data") {{vm.issueData.name}}
				span(flex="5")
				md-button.md-icon-button#additionalInfoButton(aria-label="Status Toggle")
					md-icon.angular-material-icons(ng-if="!vm.showAdditional") keyboard_arrow_right
					md-icon.angular-material-icons(ng-if="vm.showAdditional") keyboard_arrow_down

		// Info
		.issueCompItemContainer#issueCompInfoArea(layout="row", layout-align="start center", flex="none", ng-if="vm.showAdditional")
			div(flex="10")
				md-icon.angular-material-icons#issueCompStatus(style="color:{{vm.statusIcon.colour}}") {{vm.statusIcon.icon}}
			.issueCompIssueOwner(ng-if="vm.data", layout="row", layout-align="space-between", flex)
				label {{vm.data.owner}}
				label {{vm.data.timeStamp}}

		// Status
		.issueCompItemContainer#issueCompAdditional(layout="column", ng-if="vm.showAdditional")
			div(layout="row")
				md-input-container.issueCompItemStatus(flex)
					label Priority
					md-select(ng-model="vm.issueData.priority", ng-change="vm.statusChange()", ng-disabled="!vm.canUpdate")
						md-option(ng-repeat="priority in vm.priorities", value="{{priority.value}}") {{priority.label}}
				md-input-container.issueCompItemStatus(flex)
					label Status
					md-select(ng-model="vm.issueData.status", ng-change="vm.statusChange()", ng-disabled="!vm.canUpdateStatus")
						md-option(ng-repeat="status in vm.statuses", value="{{status.value}}", ng-disabled="status.disabled") {{status.label}}
			div(layout="row")
				md-input-container(flex)
					label Assign
					md-select(ng-model="vm.issueData.assigned_roles[0]", ng-change="vm.statusChange()", ng-disabled="!vm.canUpdate")
						md-option(ng-repeat="job in vm.modelJobs", value="{{job}}") {{job}}
				md-input-container(flex)
					label Type
					md-select(ng-model="vm.issueData.topic_type", ng-change="vm.statusChange()", ng-disabled="!vm.canUpdate")
						md-option(ng-repeat="type in vm.topic_types", value="{{type.value}}") {{type.label}}

	md-divider

	#descriptionAndComments(flex)
		// Description
		.issueCompItemContainer(layout="column", layout-align="start", flex)
			div(layout="column", layout-align="start", flex)
				div(ng-if="!vm.data", flex, layout="column")
					md-input-container(flex, ng-if="!vm.hideDescription")
						label Description
						textarea(
						ng-model="vm.issueData.desc"
						ng-disabled="vm.data"
						ng-focus="vm.textInputHasFocus(true)"
						ng-blur="vm.textInputHasFocus(false)")
				#issueCompDescription(ng-if="vm.data", layout="column", ng-click="vm.showViewpoint($event, vm.issueData.viewpoint)")
					div(layout='row', layout-align="space-between", flex)
						label(ng-if="!vm.editingDescription", ng-bind-html="vm.issueData.desc | linky:'_blank'") {{vm.issueData.desc}}
						md-input-container(flex, ng-if="vm.editingDescription")
							textarea(
							ng-model="vm.issueData.desc"
							aria-label="Description"
							tdr-focus="true"
							ng-focus="vm.textInputHasFocus(true)"
							ng-blur="vm.textInputHasFocus(false)")
						.issueCompTextActions(layout="row", ng-if="vm.canEditDescription")
							md-button.md-icon-button.md-accent(aria-label="Edit Comment", ng-click="vm.toggleEditDescription($event)", ng-if="vm.canUpdate")
								md-tooltip(md-direction="bottom") edit
								md-icon.angular-material-icons(style="color:{{vm.editCommentColor}}") mode_edit
				
				.issueCompThumbnail(
					ng-if="vm.descriptionThumbnail"
					ng-style="{'background-image': 'url({{vm.descriptionThumbnail}})'}"
					ng-click="vm.showScreenShot($event, vm.issueData.viewpoint)")

		// Comments
		.issueCompItemContainer(layout="column", layout-align="start", flex, ng-if="vm.issueData.comments.length>0")
			div(ng-repeat="comment in vm.issueData.comments", layout="column", layout-align="start", flex)
				div(ng-click="vm.showViewpoint($event, comment.viewpoint)"
					layout="column"
					layout-align="start"
					flex
					ng-class="{issueCompComment: !comment.action}")
					// Text and actions
					div(layout='row', layout-align="space-between", flex)
						// Saved normal comment
						label.issueCompCommentTitle(
						flex
						ng-if="!comment.editing && !comment.action"
						ng-bind-html="comment.comment | linky:'_blank'")
						// Saved auto comment

						// Editing normal comment
						md-input-container.fillHeight(flex, ng-if="comment.editing")
							textarea.fillHeight(
								ng-model="comment.comment"
								flex
								aria-label="Description"
								tdr-focus="true"
								ng-focus="vm.textInputHasFocus(true)"
								ng-blur="vm.textInputHasFocus(false)")

						.issueCompTextActions(layout="row", ng-if="!comment.sealed && !comment.action", flex="none")
							md-button.md-icon-button.md-accent(aria-label="Edit Comment", ng-click="vm.toggleEditComment($event, $index)")
								md-tooltip(md-direction="bottom") edit
								md-icon.angular-material-icons(style="color:{{vm.editCommentColor}}") mode_edit
							md-button.md-icon-button.md-accent(aria-label="Delete Comment", ng-click="vm.deleteComment($event, $index)")
								md-tooltip(md-direction="bottom") delete
								md-icon.angular-material-icons close

					// Info
					.issueCompCommentOwner(
					ng-if="vm.data && !comment.action"
					layout="row"
					layout-align="space-between"
					flex)
						label {{comment.owner}}
						label {{comment.timeStamp}}

					// Or Auto comment
					.issueCompCommentTitle(
					ng-if="comment.action"
					flex)
						label {{comment.action.propertyText}}: {{comment.action.from}} to {{comment.action.to}} by {{comment.owner}}
						
					.issueCompCommentOwner(
						ng-if="comment.action" 
						layout="row"
						layout-align="space-between"
						flex) 
						label.issueNotification Notification 
						label {{comment.timeStamp}}

				// Thumbnail
				p Screenshot: {{comment.viewpoint}}
				.issueCompThumbnail(
					layout="row"
					layout-align="center"
					ng-style="{'background-image': 'url({{comment.viewpoint.screenshot}})'}"
					ng-if="comment.viewpoint.screenshot"
					ng-click="vm.showScreenShot($event, comment.viewpoint)"
					flex)
					

	md-divider

	// New comment
	.issueCompItemContainer#issueCompNewComment(layout="column", layout-align="start", ng-if="vm.data")
		md-input-container.fillHeight(flex, md-no-float)
			textarea(
			ng-model="vm.comment"
			ng-change="vm.commentChange()"
			ng-focus="vm.textInputHasFocus(true)"
			ng-blur="vm.textInputHasFocus(false)"
			ng-disabled="!vm.canComment"
			placeholder="{{vm.canComment ? 'Comment' : (vm.issueData.status === 'closed' ? 'You cannot comment on a closed issue' : 'You do not have permission to leave comments')}}")
			.issueCompThumbnail.fillHeight(layout="row", layout-align="center", ng-if="vm.commentThumbnail", ng-click="vm.showThumbnail()")
				img.issueCompThumbnailImage(ng-src="{{vm.commentThumbnail}}")


	md-divider

	// Footer
	.issueCompItemContainer#issueCompFooterButtons(layout="row", layout-align="space-between center")
		div
			md-button.md-icon-button(
				ng-repeat="(action, actionData) in vm.actions"
				aria-label="{{action}}"
				ng-click="vm.doAction($event, action)"
				ng-disabled="vm.submitDisabled")

				md-tooltip(md-direction="bottom") {{actionData.label}}
				md-icon.angular-material-icons(style="color:{{actionData.selected ? '#FF9800' : ''}}") {{actionData.icon}}

		md-button.md-fab.md-mini(aria-label="Submit", ng-disabled="vm.submitDisabled", ng-click="vm.submit()" ng-if="!vm.saving")
			md-tooltip(md-direction="bottom") Submit
			md-icon.angular-material-icons save
		md-progress-circular(md-diameter="20px", md-mode="indeterminate" ng-if="vm.saving")

	// Action components
	issues-pin(
	account="vm.account"
	model="vm.model"
	send-event="vm.sendEvent({type: type, value: value})"
	event="vm.event"
	set-pin="vm.setPin({data: data})"
	clear-pin="vm.clearPin")
