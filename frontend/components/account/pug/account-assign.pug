.homeUserContent#accountAssignPage
	md-content.md-whiteframe-1dp(aria-label="Assign", flex)
		md-toolbar
			.md-toolbar-tools
				h2 Assign Permissions

		md-tabs(md-dynamic-height, md-border-bottom, md-selected="vm.selectedIndex", ng-click="vm.resetState()")
			
			// TEAMSPACES

			md-tab(label="Teamspace")
				div.assignTabHolder.loadingHolder(layout="row" ng-if="vm.loadingTeamspaces")
					md-progress-circular.loading
					h3 Loading Teamspace Data...

				div.assignTabHolder(layout="column" ng-if="!vm.loadingTeamspaces", flex="100")

					div(flex="100")
						md-label Select Teamspace
						md-select(aria-label="Select Teamspace" ng-model="vm.teamspaceSelected", ng-required="true")
							md-option(
								ng-repeat="teamspace in vm.adminstrableTeamspaces(vm.teamspaces)"
								aria-label="{{teamspace.account}}" 
								value="{{teamspace.account}}") {{teamspace.account}}

					md-card
						table.scrollable.checkboxes(
							ng-if="vm.teamspaceSelected && vm.selectedTeamspace.teamspacePermissions.length"
							layout="column"
							flex)

							thead(layout="row")

								tr: th.userColumn User

								tr(
									ng-if="permission !== 'teamspace_admin'"
									ng-repeat="(permission, value) in vm.teamspacePermissions"
									layout-align="center center"): th {{value}}

								tr: th.adminColumn Admin

							tbody(layout="column")
								tr(
									layout-align="center center", 
									ng-repeat="user in vm.selectedTeamspace.teamspacePermissions"
									ng-if="user.permissions !== undefined && user.user && vm.selectedTeamspace.account !== user.user && vm.account !== user.user")

									td.userColumn.userInput
										p {{user.user}} 

									
									td(ng-if="permission !== 'teamspace_admin'"
										ng-repeat="(permission, value) in vm.teamspacePermissions") 
										md-checkbox(
											ng-disabled="permission !== 'teamspace_admin' && vm.userHasPermissions(user, 'teamspace_admin')"
											aria-label="Checkbox {{value}}"
											layout-align="center center"
											ng-click="vm.teamspaceStateChange(user, permission)"
											ng-checked="vm.userHasPermissions(user, 'teamspace_admin') || vm.userHasPermissions(user, permission)")
									
									td
										md-checkbox(
											aria-label="Checkbox Admin"
											layout-align="center center"
											ng-click="vm.teamspaceStateChange(user, 'teamspace_admin')"
											ng-checked="vm.userHasPermissions(user, 'teamspace_admin')")


						h3.noUsers(ng-if="vm.selectedTeamspace.teamspacePermissions && vm.selectedTeamspace.teamspacePermissions.length === 0") No available users to assign permissions

			// PROJECT

			md-tab(label="Project", ng-click="vm.resetState()")
				div.assignTabHolder.loadingHolder(layout="row" ng-if="vm.projectsLoading")
					md-progress-circular.loading
					h3 Loading Teamspace Data...

				div.assignTabHolder(layout="column" ng-if="!vm.projectsLoading", flex="100")

					div(layout="row")
						div(flex="50", layout="column")
							md-label Select Teamspace
							md-select.rowSelects(aria-label="Select Teamspace" ng-model="vm.teamspaceSelected", ng-required="true")
								md-option(
									aria-label="{{teamspace.account}}" 
									ng-repeat="teamspace in vm.adminstrableProjectTeamspaces(vm.teamspaces)"
									value="{{teamspace.account}}") {{teamspace.account}}

						div(flex="50", layout="column", ng-disabled="!vm.teamspaceSelected")
							md-label Select Project
							md-select.rowSelects(
								aria-label="Select Project" 
								ng-disabled="!vm.teamspaceSelected"
								ng-model="vm.projectSelected", 
								ng-required="true")

								md-option(
									aria-label="{{project.name}}" 
									ng-repeat="project in vm.projects"
									value="{{project.name}}") {{project.name}}

					h3(ng-if="!vm.modelReady")

					md-card
						table.scrollable.checkboxes(
							ng-if="vm.projectSelected"
							layout="column", 
							flex)
							thead(layout="column")
								tr
									th.userColumn User

									th(ng-if="permission !== 'admin_project'"
										ng-repeat="(permission, value) in vm.projectPermissions"
										layout-align="center center") {{value}}

									th.adminColumn Admin

							tbody(layout="column")
								tr(
									layout-align="center center", 
									ng-repeat="user in vm.selectedTeamspace.teamspacePermissions"
									ng-if="user.permissions !== undefined && vm.selectedTeamspace.account != user.user && user.user && vm.account !== user.user")

									td.userColumn.userInput
										p {{user.user}}

									td(ng-if="permission !== 'admin_project'"
										ng-repeat="(permission, value) in vm.projectPermissions") 

										md-checkbox(
											ng-disabled="permission !== 'admin_project' && vm.userHasProjectPermissions(user, 'admin_project')"
											aria-label="Project Permission {{value}}"
											layout-align="center center"
											ng-click="vm.projectStateChange(user, permission)"
											ng-checked="vm.userHasProjectPermissions(user, permission) || vm.userHasProjectPermissions(user, 'admin_project')")

									td
										md-checkbox(
											aria-label="Checkbox Admin"
											layout-align="center center"
											ng-click="vm.projectStateChange(user, 'admin_project')"
											ng-checked="vm.userHasProjectPermissions(user, 'admin_project')")
						
						h3.noUsers(ng-if="vm.selectedTeamspace.teamspacePermissions && vm.selectedTeamspace.teamspacePermissions.length === 0") No available users to assign permissions


			// MODELS & FEDERATIONS

			md-tab(label="Models & Federations", ng-click="vm.resetState()")
				div.assignTabHolder.loadingHolder(layout="row", ng-if="vm.loadingTeamspaces || vm.projectsLoading")
					md-progress-circular.loading
					h3 Loading Teamspace Data...

				div.assignTabHolder(layout="column", ng-if="(!vm.isFromUrl && !vm.loadingTeamspaces && !vm.projectsLoading) || (vm.isFromUrl && vm.modelReady)", flex="100")
					div(layout="row")
						div(flex="33", layout="column")
							md-label Select Teamspace
							md-select.rowSelects(
								aria-label="Selection for Teamspace"
								ng-model="vm.teamspaceSelected"
								ng-required="true")
								md-option(
									aria-label="{{teamspace.account}}" 
									ng-repeat="teamspace in vm.teamspaces"
									value="{{teamspace.account}}") {{teamspace.account}}

						div(flex="33", layout="column")
							md-label Select Project
							md-select.rowSelects(
								aria-label="Selection for Project"
								ng-model="vm.projectSelected"
								ng-disabled="!vm.teamspaceSelected"
								ng-required="true")
								md-option(
									aria-label="{{project.name}}" 
									ng-repeat="project in vm.projects"
									value="{{project.name}}") {{project.name}}

						div(flex="33", layout="column")
							md-label(ng-if="vm.modelsLoaded()") Select Model / Federation
							md-label(ng-if="!vm.modelsLoaded()") Awaiting Models / Federations...
							md-select.rowSelects(
								aria-label="Selection for Model"
								ng-model="vm.modelSelected"
								ng-required="true" 
								ng-disabled="!vm.models || !vm.modelsLoaded()")

								md-option(
									aria-label="{{model.name}}" 
									ng-repeat="model in vm.models"
									value="{{model.model}}") {{model.name}}

					md-card
						table.scrollable.radiobuttons(
							ng-if="vm.modelSelected"
							layout="column", 
							flex)
							thead(layout="row")
								tr: th.fixedWidth.userColumn User
								tr(ng-repeat="value in vm.modelRoles", layout-align="center center"): th.fixedWidth.sentenceCase {{value}}

							tbody(layout="column", ng-if="vm.selectedModel && vm.modelReady")
								tr(
									layout-align="center center", 
									ng-repeat="user in vm.selectedTeamspace.teamspacePermissions"
									ng-init="vm.addUser(user.user)"
									ng-if="vm.selectedTeamspace.account != user.user && user.user && vm.account !== user.user")

									td.fixedWidth.userColumn.userInput()
										p {{user.user}}

									td.fixedWidth(ng-repeat="value in vm.modelRoles", layout-align="center center")

										md-radio-group(	
											ng-model="vm.selectedRole[user.user]"
											layout-align="center center"
											layout="row")

											md-radio-button(
												aria-label="{{value}}"
												ng-click="vm.modelStateChange(user, value)"
												layout-align="center center"
												ng-value="value")

						h3.noUsers(ng-if="vm.selectedTeamspace.teamspacePermissions && vm.selectedTeamspace.teamspacePermissions.length === 0") No available users to assign permissions
